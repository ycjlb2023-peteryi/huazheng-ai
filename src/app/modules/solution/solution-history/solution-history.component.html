<div class="solution-history">
  <app-page-header 
    title="å†å²æ–¹æ¡ˆè®°å½•" 
    subtitle="æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ç”Ÿæˆçš„æŠ€æœ¯æ–¹æ¡ˆ"
  >
    <div actions>
      <button class="btn btn-primary" (click)="createNew()">
        <span>âš¡</span>
        <span>ç”Ÿæˆæ–°æ–¹æ¡ˆ</span>
      </button>
    </div>
  </app-page-header>
  
  <div class="history-content">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-label">å…¨éƒ¨æ–¹æ¡ˆ</span>
        <span class="stat-value">{{ stats().total }}</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <span class="stat-label">å·²å®Œæˆ</span>
        <span class="stat-value success">{{ stats().completed }}</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <span class="stat-label">è‰ç¨¿</span>
        <span class="stat-value warning">{{ stats().draft }}</span>
      </div>
    </div>
    
    <!-- ç­›é€‰æ  -->
    <div class="filter-bar card">
      <div class="search-box">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="search-icon">
          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="æœç´¢æ–¹æ¡ˆ..."
          [value]="searchKeyword()"
          (input)="updateSearchKeyword($any($event.target).value)"
        />
      </div>
      
      <div class="filter-buttons">
        <button
          class="filter-btn"
          [class.active]="selectedFilter() === 'all'"
          (click)="updateFilter('all')"
        >
          å…¨éƒ¨
        </button>
        <button
          class="filter-btn"
          [class.active]="selectedFilter() === 'completed'"
          (click)="updateFilter('completed')"
        >
          å·²å®Œæˆ
        </button>
        <button
          class="filter-btn"
          [class.active]="selectedFilter() === 'draft'"
          (click)="updateFilter('draft')"
        >
          è‰ç¨¿
        </button>
      </div>
    </div>
    
    <!-- æ–¹æ¡ˆåˆ—è¡¨ -->
    @if (filteredSolutions().length > 0) {
      <div class="solutions-grid">
        @for (solution of filteredSolutions(); track solution.id) {
          <div class="solution-card card fade-in" [style.animation-delay]="$index * 0.05 + 's'">
            <div class="card-header">
              <div class="card-icon">ğŸ“„</div>
              <div class="card-meta">
                <span class="card-time">{{ formatDate(solution.createdAt) }}</span>
                @if (solution.status === 'completed') {
                  <span class="badge badge-success">å·²å®Œæˆ</span>
                } @else {
                  <span class="badge badge-warning">è‰ç¨¿</span>
                }
              </div>
            </div>
            
            <div class="card-body">
              <h3 class="card-title text-ellipsis-2">{{ solution.productJudgment }}</h3>
              
              <div class="card-stats">
                <div class="stat-chip">
                  <span class="chip-icon">âœ…</span>
                  <span class="chip-text">{{ solution.recommendedConfig.standard.length }}é¡¹æ ‡é…</span>
                </div>
                <div class="stat-chip">
                  <span class="chip-icon">ğŸ”¸</span>
                  <span class="chip-text">{{ solution.recommendedConfig.optional.length }}é¡¹é€‰é…</span>
                </div>
                <div class="stat-chip">
                  <span class="chip-icon">â“</span>
                  <span class="chip-text">{{ solution.questionsForCustomer.length }}ä¸ªé—®é¢˜</span>
                </div>
              </div>
              
              <div class="card-preview">
                <h4 class="preview-title">æŠ€æœ¯ä¾æ®</h4>
                <div class="preview-tags">
                  @for (basis of solution.technicalBasis.slice(0, 2); track basis) {
                    <span class="preview-tag text-ellipsis">{{ basis }}</span>
                  }
                  @if (solution.technicalBasis.length > 2) {
                    <span class="preview-tag more">+{{ solution.technicalBasis.length - 2 }}</span>
                  }
                </div>
              </div>
            </div>
            
            <div class="card-footer">
              <button class="btn btn-sm btn-primary" (click)="viewSolution(solution.id)">
                æŸ¥çœ‹è¯¦æƒ…
              </button>
              <button class="btn-icon btn-danger" (click)="deleteSolution(solution.id, $event)" title="åˆ é™¤">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path fill-rule="evenodd" d="M5 3a1 1 0 011-1h4a1 1 0 011 1v1h3a1 1 0 110 2h-1v7a2 2 0 01-2 2H5a2 2 0 01-2-2V6H2a1 1 0 110-2h3V3zm2 2h2V4H7v1zm1 3a1 1 0 00-1 1v3a1 1 0 102 0V9a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>
        }
      </div>
    } @else {
      <app-empty-state
        title="æ²¡æœ‰æ‰¾åˆ°æ–¹æ¡ˆ"
        [description]="searchKeyword() ? 'è¯•è¯•å…¶ä»–æœç´¢å…³é”®è¯' : 'è¿˜æ²¡æœ‰ç”Ÿæˆä»»ä½•æ–¹æ¡ˆ'"
        [actionText]="!searchKeyword() ? 'ç”Ÿæˆæ–°æ–¹æ¡ˆ' : ''"
        (action)="createNew()"
      />
    }
  </div>
</div>

